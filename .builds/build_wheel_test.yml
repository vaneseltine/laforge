image: archlinux
environment:
  PATH: "${PATH}:$HOME/.local/bin"
secrets:
  - 2b416998-c1cc-496b-8365-2da512b3fc43
packages:
  - python
  - python-pip
  - python-setuptools
  - python-numpy
sources:
  - https://git.sr.ht/~matvan/laforge
tasks:
  - build: |
        cat ~/.buildenv
        cd laforge
        python -m pip install --user -q --upgrade pip wheel setuptools
        python -m pip freeze
        python setup.py bdist_wheel
  - prep: |
        cd laforge
        python -m pip install --user -e .
        python -m laforge --version
        python -m pip uninstall laforge -y
  - install: |
        python -m pip install --user --no-index --find-links=laforge/dist laforge
        python -m pip freeze
  - invoke: |
        cd /
        python -m pip freeze
        python -c "import laforge;print(laforge.__version__)"
        python -m laforge --version
        laforge --version
        laforge consult
